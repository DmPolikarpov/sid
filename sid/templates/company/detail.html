{% extends 'base.html' %}
{% block content %}
    <!--the detail information for each company-->
    <div class="company-detail">
        <h1>{{ company.name }}</h1>
        <!--Tabs for the page-->
        <script type="text/javascript" src="{{ url_for('static', filename='js/company_detail.js', v=1) }}"></script>
        <ul id="tabs">
            <li><a href="#" title="tab1">Профиль</a></li>
            <li><a href="#" title="tab2">Акции</a></li>
            <li><a href="#" title="tab3">Финансовая отчетность</a></li>
        </ul>
        <!--The content for each tab-->
        <div id="content">
            <div id="tab1">
                <div class="profile">
                    <h2>{{ company.name }} ({{ company.ticker }})</h2>
                    <h3>Описание</h3>
                    <p>{{ company.description }}</p>
                    <h3>Тикер</h3>
                    <p>{{ company.ticker }}</p>
                    <h3>Вэбсайт</h3>
                    <p>{{ company.website }}</p>
                    <h3>Биржа</h3>
                    <p>{{ company.exchange }} ({{ company.exchange_short_name }})</p>
                </div>
                <div class="logo">
                    <img src="../../static/{{ company.logo }}">
                </div>
            </div>
            <div id="tab2">
                <div>
                    <h2>{{ company.name }} - {{ company.ticker }}</h2>
                    <h3>котировки: информация временно недоступна</h3>
                    <h3>биржа: {{ company.exchange }} ({{ company.exchange_short_name }})</h3>
                </div>
                <table>
                    <tr>
                        <td>
                            <button id="0" type="button">1 месяц</button>
                        </td>
                        <td rowspan="6">
                            <canvas id="myChart"></canvas>
                        </td>
                    </tr>
                    <tr><td><button id="1" type="button">6 месяцев</button></td></tr>
                    <tr><td><button id="2" type="button">1 год</button></td></tr>
                    <tr><td><button id="3" type="button">5 лет</button></td></tr>
                    <tr><td><button id="4" type="button">10 лет</button></td></tr>
                    <tr><td><button id="5" type="button">за все время</button></td></tr>
                </table>
                <div>
                    <h1>Финансовые показатели</h1>
                    <h3>раздел находится в разработке</h3>
                </div>
            </div>
            <div id="tab3">
                <h1>Балансовая ведомость</h1>

                <select>
                    <option value="cash_and_cash_equivalents">денежные средства и денежные эквиваленты</option>
                    <option value="net_receivables">чистая дебиторская задолженность</option>
                    <option value="inventory">запасы</option>
                    <option value="total_current_assets">итого (оборотных активов)</option>
                    <option value="property_plant_equipment_net">основные средства</option>
                    <option value="intangible_assets">нематериальные активы</option>
                    <option value="total_non_current_assets">итого (внеоборотных активов)</option>
                    <option value="total_assets">баланс (активы)</option>
                    <option value="account_payables">кредиторская задолженность</option>
                    <option value="total_current_liabilities">итого (краткосрочные обязательства)</option>
                    <option value="total_non_current_liabilities">итого (долгосрочные обязательства)</option>
                    <option value="long_term_debt">долгосрочная задолженность</option>
                    <option value="total_liabilities">баланс (пассивы)</option>
                    <option value="common_stock">обыкновенные акции</option>
                    <option value="retained_earnings">нераспределенная прибыль</option>
                    <option value="total_stockholders_equity">общий акционерный капитал</option>
                    <option value="total_liabilities_and_stockholders_equity">общие обязательства и акционерный капитал</option>
                    <option value="total_investments">всего вложений</option>
                    <option value="total_debt">общая задолженность</option>
                    <option value="net_debt">чистый долг</option>
                </select>
                <select>
                    <option value="twoYears">2 года</option>
                    <option value="fiveYears">5 лет</option>
                    <option value="tenYears">10 лет</option>
                </select>
            </div>
        </div>
    </div>
    <script>
        function getShareChartData(period) {
            let labels = []
            let price_data = []
            let volume_data = []
            if (period == 'one_month') {
                {% for share in shares %}
                    {% if share.trading_date > one_month %}
                        labels.push('{{ share.trading_date }}')
                        price_data.push('{{ share.close_price }}')
                        volume_data.push('{{ share.volume }}')
                    {% endif %}
                {% endfor %}
                var price_label = '1 месяц'
            } else if (period == 'six_months') {
                {% for share in shares %}
                    {% if share.trading_date > six_months %}
                        labels.push('{{ share.trading_date }}')
                        price_data.push('{{ share.close_price }}')
                        volume_data.push('{{ share.volume }}')
                    {% endif %}
                {% endfor %}
                var price_label = '6 месяцев'
            } else if (period == 'one_year') {
                {% for share in shares %}
                    {% if share.trading_date > one_year %}
                        labels.push('{{ share.trading_date }}')
                        price_data.push('{{ share.close_price }}')
                        volume_data.push('{{ share.volume }}')
                    {% endif %}
                {% endfor %}
                var price_label = '1 год'
            } else if (period == 'five_years') {
                {% for share in shares %}
                    {% if share.trading_date > five_years %}
                        labels.push('{{ share.trading_date }}')
                        price_data.push('{{ share.close_price }}')
                        volume_data.push('{{ share.volume }}')
                    {% endif %}
                {% endfor %}
                var price_label = '5 лет'
            } else if (period == 'ten_years') {
                {% for share in shares %}
                    {% if share.trading_date > ten_years %}
                        labels.push('{{ share.trading_date }}')
                        price_data.push('{{ share.close_price }}')
                        volume_data.push('{{ share.volume }}')
                    {% endif %}
                {% endfor %}
                var price_label = '10 лет'
            } else if (period == 'all_time') {
                {% for share in shares %}
                    labels.push('{{ share.trading_date }}')
                    price_data.push('{{ share.close_price }}')
                    volume_data.push('{{ share.volume }}')
                {% endfor %}
                var price_label = 'за все время'
            }

            const shareData = {
                    labels: labels.sort(),
                    datasets: [{
                        label: price_label,
                        data: price_data,
                        borderColor: "#3e95cd",
                        yAxisID: 'share_price',
                        type: 'line'
                    },
                    {
                        label: 'volume',
                        data: volume_data,
                        borderColor: "#3e95cd",
                        backgroundColor: "rgb(255,0,0)",
                        yAxisID: 'volume'
                    }]
                }

            return shareData;
        }

        const shareOptions = {
            scales:{
                yAxes:[{
                    ticks:{
                        beginAtZero: true
                    },
                    position: 'left',
                    display: true,
                    id: 'share_price'
                },
                {
                    ticks:{
                        beginAtZero:true
                    },
                    position: 'right',
                    display: true,
                    id: 'volume'
                }],
            },
        }

        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {type: 'bar', data: getShareChartData('one_year'), options: shareOptions})

        document.getElementById("0").addEventListener('click', () => {
            chart.config.data = getShareChartData('one_month')
            chart.update();
        });
        document.getElementById("1").addEventListener('click', () => {
            chart.config.data = getShareChartData('six_months')
            chart.update();
        });
        document.getElementById("2").addEventListener('click', () => {
            chart.config.data = getShareChartData('one_year')
            chart.update();
        });
        document.getElementById("3").addEventListener('click', () => {
            chart.config.data = getShareChartData('five_years')
            chart.update();
        });
        document.getElementById("4").addEventListener('click', () => {
            chart.config.data = getShareChartData('ten_years')
            chart.update();
        });
        document.getElementById("5").addEventListener('click', () => {
            chart.config.data = getShareChartData('all_time')
            chart.update();
        });

    </script>
{% endblock %}